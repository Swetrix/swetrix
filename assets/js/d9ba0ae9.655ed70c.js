"use strict";(globalThis.webpackChunk_swetrix_docs=globalThis.webpackChunk_swetrix_docs||[]).push([[570],{1296(e,t,a){a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(8168),r=(a(6540),a(5680));const l={title:"Server-side validation",slug:"/captcha/server-side-validation"},i=void 0,o={unversionedId:"captcha/server-side-validation",id:"captcha/server-side-validation",title:"Server-side validation",description:"Introduction",source:"@site/docs/captcha/server-side-validation.md",sourceDirName:"captcha",slug:"/captcha/server-side-validation",permalink:"/swetrix/captcha/server-side-validation",draft:!1,editUrl:"https://github.com/swetrix/docs/edit/main/docs/captcha/server-side-validation.md",tags:[],version:"current",frontMatter:{title:"Server-side validation",slug:"/captcha/server-side-validation"},sidebar:"docs",previous:{title:"Client-side usage",permalink:"/swetrix/captcha/client-side-usage"},next:{title:"Testing",permalink:"/swetrix/captcha/testing"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Validation via HTTP request",id:"validation-via-http-request",level:2},{value:"Validation via Node.js library",id:"validation-via-nodejs-library",level:2}],d={toc:p};function u({components:e,...t}){return(0,r.yg)("wrapper",(0,n.A)({},d,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"introduction"},"Introduction"),(0,r.yg)("p",null,"You have to validate the user's response to the CAPTCHA on your server. The token should be considered valid only if you validated it on your backend, otherwise it can be easily spoofed (the presence of the token in the request is not enough to consider it valid as an attacker can easily send a request with any string as a token)."),(0,r.yg)("p",null,"The validation endpoint accepts the CAPTHCA token and your project-specific secret key and returns a JSON response with the validation result."),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"Token validation can only be performed once, if you try to validate the same token twice, the second validation will fail. This is done to prevent token reuse attacks.")),(0,r.yg)("h2",{id:"validation-via-http-request"},"Validation via HTTP request"),(0,r.yg)("p",null,"To validate the token, you have to send a POST request to the ",(0,r.yg)("inlineCode",{parentName:"p"},"https://api.swetrix.com/v1/captcha/validate")," URL, with the following parameters:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Parameter"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"token"),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"The token returned by the CAPTCHA widget.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"secret"),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"Your CAPTCHA project secret key.")))),(0,r.yg)("br",null),(0,r.yg)("p",null,"The successful response will have the ",(0,r.yg)("inlineCode",{parentName:"p"},"success")," field set to ",(0,r.yg)("inlineCode",{parentName:"p"},"true")," and the ",(0,r.yg)("inlineCode",{parentName:"p"},"data")," field will contain the following fields:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Field"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"hash"),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"The hash of CAPTCHA user passed.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"timestamp"),(0,r.yg)("td",{parentName:"tr",align:null},"number"),(0,r.yg)("td",{parentName:"tr",align:null},"The timestamp of CAPTCHA user passed.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"pid"),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"The ID of the CAPTCHA project.")))),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "success": true,\n  "data": {\n    "hash": "HASH_12345678",\n    "timestamp": 1111111111,\n    "pid": "PROJECTID123"\n  }\n}\n')),(0,r.yg)("br",null),(0,r.yg)("p",null,"The failed response will throw an error that will look like the following example. The HTTP status code will correspond to the ",(0,r.yg)("inlineCode",{parentName:"p"},"statusCode")," in JSON."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "statusCode": 400,\n  "message": "Could not decrypt token",\n  "error": "Bad Request"\n}\n')),(0,r.yg)("br",null),(0,r.yg)("p",null,"Here's an example of how to validate the token using ",(0,r.yg)("inlineCode",{parentName:"p"},"curl"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'curl -X POST\\\n  -H "Content-Type: application/json"\\\n  -d \'{"token": "<token>", "secret": "<secret>"}\'\\\n  https://api.swetrix.com/v1/captcha/validate\n')),(0,r.yg)("h2",{id:"validation-via-nodejs-library"},"Validation via Node.js library"),(0,r.yg)("p",null,"You can use the ",(0,r.yg)("a",{parentName:"p",href:"https://www.npmjs.com/package/@swetrix/captcha-validator"},"@swetrix/captcha-validator")," package to validate the token in your Node.js project."),(0,r.yg)("p",null,"You can use this package in your Node.js (or NestJS, ExpressJS, etc.) project to validate the user's response to the CAPTCHA.\nThe package exports a single function ",(0,r.yg)("inlineCode",{parentName:"p"},"validateToken")," which takes arguments listed below and returns a Promise."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Argument"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Required"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"token"),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"The token returned by the CAPTCHA widget."),(0,r.yg)("td",{parentName:"tr",align:null},"YES")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"secretKey"),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"Your CAPTCHA project secret key."),(0,r.yg)("td",{parentName:"tr",align:null},"YES")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"apiURL"),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"The API URL to use (default: ",(0,r.yg)("inlineCode",{parentName:"td"},"https://api.swetrix.com/captcha"),"), this one may be used in case you're selfhosting the API."),(0,r.yg)("td",{parentName:"tr",align:null},"NO")))),(0,r.yg)("br",null),(0,r.yg)("p",null,"Here's an example of how to use the package in your project:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"const { validateToken } = require('@swetrix/captcha-validator')\n// or\nimport { validateToken } from '@swetrix/captcha-validator'\n\n// somewhere inside the controller of your form where the CAPTCHA is used\nvalidateToken('CAPTCHA_TOKEN', 'YOUR_SECRET_KEY').then((result) => {\n  const [status, data] = result\n  // status is a boolean, true if the token is valid, false otherwise\n  // data is an error message if status is false\n  console.log(status, data)\n})\n")))}u.isMDXComponent=!0},5680(e,t,a){a.d(t,{xA:()=>d,yg:()=>c});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef(function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),g=p(a),c=r,y=g["".concat(s,".").concat(c)]||g[c]||u[c]||l;return a?n.createElement(y,i(i({ref:t},d),{},{components:a})):n.createElement(y,i({ref:t},d))});function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=g;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"}}]);