"use strict";(globalThis.webpackChunk_swetrix_docs=globalThis.webpackChunk_swetrix_docs||[]).push([[7601],{5680(e,r,t){t.d(r,{xA:()=>u,yg:()=>g});var n=t(6540);function i(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function a(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach(function(r){i(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function s(e,r){if(null==e)return{};var t,n,i=function(e,r){if(null==e)return{};var t,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(i[t]=e[t]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=n.createContext({}),p=function(e){var r=n.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):a(a({},r),e)),t},u=function(e){var r=p(e.components);return n.createElement(c.Provider,{value:r},e.children)},l={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef(function(e,r){var t=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(t),g=i,y=d["".concat(c,".").concat(g)]||d[g]||l[g]||o;return t?n.createElement(y,a(a({ref:r},u),{},{components:t})):n.createElement(y,a({ref:r},u))});function g(e,r){var t=arguments,i=r&&r.mdxType;if("string"==typeof e||i){var o=t.length,a=new Array(o);a[0]=d;var s={};for(var c in r)hasOwnProperty.call(r,c)&&(s[c]=r[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var p=2;p<o;p++)a[p]=t[p];return n.createElement.apply(null,a)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7455(e,r,t){t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=t(8168),i=(t(6540),t(5680));const o={title:"How to proxy Swetrix with Nginx",slug:"/adblockers/guides/nginx"},a=void 0,s={unversionedId:"adblockers/guides/nginx",id:"adblockers/guides/nginx",title:"How to proxy Swetrix with Nginx",description:"If you are already using Nginx on your website, you can add Swetrix to your configuration to proxy it.",source:"@site/docs/adblockers/guides/nginx.md",sourceDirName:"adblockers/guides",slug:"/adblockers/guides/nginx",permalink:"/swetrix/adblockers/guides/nginx",draft:!1,editUrl:"https://github.com/swetrix/docs/edit/main/docs/adblockers/guides/nginx.md",tags:[],version:"current",frontMatter:{title:"How to proxy Swetrix with Nginx",slug:"/adblockers/guides/nginx"},sidebar:"docs",previous:{title:"How to proxy Swetrix with Next.js",permalink:"/swetrix/adblockers/guides/nextjs"},next:{title:"Statistics API reference",permalink:"/swetrix/statistics-api"}},c={},p=[{value:"Update your Nginx configuration",id:"update-your-nginx-configuration",level:2},{value:"Update Swetrix tracking script configuration",id:"update-swetrix-tracking-script-configuration",level:2}],u={toc:p};function l({components:e,...r}){return(0,i.yg)("wrapper",(0,n.A)({},u,r,{components:e,mdxType:"MDXLayout"}),(0,i.yg)("p",null,"If you are already using Nginx on your website, you can add Swetrix to your configuration to proxy it."),(0,i.yg)("h2",{id:"update-your-nginx-configuration"},"Update your Nginx configuration"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"# The `proxy_cache` part is only needed if you cache swetrix.js script.\n# If you use Swetrix from NPM, there's no need to proxy it.\n#\n# Note: to use the `proxy_cache` setup, you'll need to make sure the `/var/run/nginx-cache`\n#\xa0directory exists\xa0(e.g. creating it in a build step with `mkdir -p /var/run/nginx-cache`)\n# and is readable (including all its parent directories) by your nginx worker user.\n#\n# To make `/var/run/nginx-cache` persist during reboots of your server\n# make sure to run `echo \"D /var/run/nginx-cache 0755 root root -\" > /usr/lib/tmpfiles.d/nginx-cache.conf`\nproxy_cache_path /var/run/nginx-cache/jscache levels=1:2 keys_zone=jscache:100m inactive=30d  use_temp_path=off max_size=100m;\n\nserver {\n  # Using the Cloudflare DNS resolver, you can remove this line if you already use a resolver in your config, or change it to a resolver of your choice.\n  resolver 1.1.1.1;\n\n  set $swetrix_script_host swetrix.org;\n  set $swetrix_api_host api.swetrix.com;\n  set $swetrix_script_url https://$swetrix_script_host/swetrix.js;\n  set $swetrix_api_url https://$swetrix_api_host;\n\n  location = /script.js {\n    proxy_pass $swetrix_script_url;\n    proxy_set_header Host $swetrix_script_host;\n    proxy_ssl_server_name on;\n    proxy_buffering on;\n\n    # Cache the script for 6 hours, as long as swetrix.org returns a valid response\n    proxy_cache jscache;\n    proxy_cache_valid 200 301 302 6h;\n    proxy_cache_use_stale updating error timeout invalid_header http_500;\n  }\n\n  location /log {\n    proxy_set_header Host                $swetrix_api_host;\n    proxy_set_header X-Client-IP-Address $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto   $scheme;\n\n    proxy_ssl_server_name      on;\n    proxy_buffering            on;\n    proxy_pass_request_headers on;\n\n    proxy_pass $swetrix_api_url$request_uri;\n  }\n}\n")),(0,i.yg)("h2",{id:"update-swetrix-tracking-script-configuration"},"Update Swetrix tracking script configuration"),(0,i.yg)("p",null,"After you updated your Nginx configuration, you need to update swetrix.js tracking script to send analytics data through your server. You can do it by setting the ",(0,i.yg)("inlineCode",{parentName:"p"},"apiURL")," property inside the ",(0,i.yg)("a",{parentName:"p",href:"/swetrix-js-reference#init"},"init() function"),"."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"swetrix.init('YOUR_PROJECT_ID', {\n  apiURL: 'https://<yourproxydomain>/log',\n})\n")),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("p",{parentName:"admonition"},"If you are not using the ",(0,i.yg)("a",{parentName:"p",href:"/install-script#install-swetrix-via-npm"},"Swetrix NPM package"),", don't forget to also replace ",(0,i.yg)("inlineCode",{parentName:"p"},"https://swetrix.org/swetrix.js")," with your proxy URL in the analytics ",(0,i.yg)("inlineCode",{parentName:"p"},"<script>")," tag.")))}l.isMDXComponent=!0}}]);