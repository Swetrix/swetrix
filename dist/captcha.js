!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";const e=["en","de","fr","pl","uk"],t="en",i={en:{iAmHuman:"I am human",verificationFailed:"Verification failed, click to retry",verifying:"Verifying...",ariaCheckbox:"Human verification checkbox. Press Enter or Space to verify you are human.",ariaVerifying:"Verifying that you are human. Please wait.",ariaSuccess:"Verification successful. You have been verified as human.",ariaFailed:"Verification failed. Press Enter or Space to try again.",srLoading:"Verification in progress. Please wait.",srSuccess:"Verification successful!",srFailed:"Verification failed. Please try again.",ariaProgress:"Verification progress"},de:{iAmHuman:"Ich bin ein Mensch",verificationFailed:"Verifizierung fehlgeschlagen, klicken Sie zum Wiederholen",verifying:"Verifizierung...",ariaCheckbox:"Kontrollkästchen zur menschlichen Verifizierung. Drücken Sie Enter oder Leertaste, um zu bestätigen, dass Sie ein Mensch sind.",ariaVerifying:"Verifizierung, dass Sie ein Mensch sind. Bitte warten.",ariaSuccess:"Verifizierung erfolgreich. Sie wurden als Mensch verifiziert.",ariaFailed:"Verifizierung fehlgeschlagen. Drücken Sie Enter oder Leertaste, um es erneut zu versuchen.",srLoading:"Verifizierung läuft. Bitte warten.",srSuccess:"Verifizierung erfolgreich!",srFailed:"Verifizierung fehlgeschlagen. Bitte versuchen Sie es erneut.",ariaProgress:"Verifizierungsfortschritt"},fr:{iAmHuman:"Je suis humain",verificationFailed:"Vérification échouée, cliquez pour réessayer",verifying:"Vérification...",ariaCheckbox:"Case de vérification humaine. Appuyez sur Entrée ou Espace pour confirmer que vous êtes humain.",ariaVerifying:"Vérification en cours. Veuillez patienter.",ariaSuccess:"Vérification réussie. Vous avez été vérifié comme humain.",ariaFailed:"Vérification échouée. Appuyez sur Entrée ou Espace pour réessayer.",srLoading:"Vérification en cours. Veuillez patienter.",srSuccess:"Vérification réussie !",srFailed:"Vérification échouée. Veuillez réessayer.",ariaProgress:"Progression de la vérification"},pl:{iAmHuman:"Jestem człowiekiem",verificationFailed:"Weryfikacja nie powiodła się, kliknij, aby spróbować ponownie",verifying:"Weryfikacja...",ariaCheckbox:"Pole wyboru weryfikacji człowieka. Naciśnij Enter lub Spację, aby potwierdzić, że jesteś człowiekiem.",ariaVerifying:"Trwa weryfikacja, że jesteś człowiekiem. Proszę czekać.",ariaSuccess:"Weryfikacja zakończona pomyślnie. Zostałeś zweryfikowany jako człowiek.",ariaFailed:"Weryfikacja nie powiodła się. Naciśnij Enter lub Spację, aby spróbować ponownie.",srLoading:"Weryfikacja w toku. Proszę czekać.",srSuccess:"Weryfikacja zakończona pomyślnie!",srFailed:"Weryfikacja nie powiodła się. Spróbuj ponownie.",ariaProgress:"Postęp weryfikacji"},uk:{iAmHuman:"Я людина",verificationFailed:"Перевірка не вдалася, натисніть, щоб спробувати знову",verifying:"Перевірка...",ariaCheckbox:"Прапорець перевірки людини. Натисніть Enter або Пробіл, щоб підтвердити, що ви людина.",ariaVerifying:"Перевіряємо, що ви людина. Будь ласка, зачекайте.",ariaSuccess:"Перевірка успішна. Вас підтверджено як людину.",ariaFailed:"Перевірка не вдалася. Натисніть Enter або Пробіл, щоб спробувати знову.",srLoading:"Перевірка триває. Будь ласка, зачекайте.",srSuccess:"Перевірка успішна!",srFailed:"Перевірка не вдалася. Будь ласка, спробуйте ще раз.",ariaProgress:"Прогрес перевірки"}},r=i=>{const r=i.toLowerCase().split("-")[0].split("_")[0];return(t=>e.includes(t))(r)?r:t},a="[Swetrix Captcha]",n=(...e)=>console.log(a,...e),o=(...e)=>console.error(a,...e),s=(...e)=>console.warn(a,...e),c=window.__SWETRIX_CAPTCHA_DEV||!1,l=c?"http://localhost:5005/v1/captcha":"https://api.swetrixcaptcha.com/v1/captcha",u=window.__SWETRIX_API_URL||l,d=c?"./pow-worker.js":"https://cdn.swetrixcaptcha.com/pow-worker.js",f=1e8,h=3e5,m="/generate",y="/verify";var w,g;!function(e){e.SUCCESS="success",e.FAILURE="failure",e.TOKEN_EXPIRED="tokenExpired"}(w||(w={})),function(e){e.checkbox="checkbox",e.failure="failure",e.completed="completed",e.loading="loading"}(g||(g={}));let p=g.checkbox,k=null;const b=(()=>{const e=new URLSearchParams(window.location.search).get("lang");return n("lang",e),e?r(e):(()=>{if("undefined"==typeof navigator)return t;const e=navigator.languages||[navigator.language];for(const i of e){const e=r(i);if(e!==t||i.toLowerCase().startsWith("en"))return e}return t})()})(),v=i[b]||i[t];n("t:",v);const S=(e,t={})=>{window.parent.postMessage({event:e,type:"swetrix-captcha",cid:window.__SWETRIX_CAPTCHA_ID,...t},"*")},E=e=>{const t=document.querySelector("#progress-bar-container"),i=document.querySelector("#progress-bar");t&&i&&(e<0?(t.classList.add("show"),i.classList.add("indeterminate"),i.style.width="",t.setAttribute("aria-valuenow","0"),t.removeAttribute("aria-valuenow")):0===e?(t.classList.remove("show"),i.classList.remove("indeterminate"),i.style.width="0%",t.setAttribute("aria-valuenow","0")):e>=100?(i.classList.remove("indeterminate"),i.style.width="100%",t.setAttribute("aria-valuenow","100"),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{i.style.width="0%"},300)},400)):(t.classList.add("show"),i.classList.remove("indeterminate"),i.style.width=`${Math.min(e,95)}%`,t.setAttribute("aria-valuenow",String(Math.round(e)))))},A=e=>{const t=document.querySelector("#swetrix-captcha");if(!t)return;switch(e){case g.checkbox:t.setAttribute("role","checkbox"),t.setAttribute("aria-checked","false"),t.setAttribute("aria-busy","false"),t.setAttribute("aria-label",v.ariaCheckbox);break;case g.loading:t.setAttribute("role","status"),t.setAttribute("aria-checked","mixed"),t.setAttribute("aria-busy","true"),t.setAttribute("aria-label",v.ariaVerifying);break;case g.completed:t.setAttribute("role","checkbox"),t.setAttribute("aria-checked","true"),t.setAttribute("aria-busy","false"),t.setAttribute("aria-label",v.ariaSuccess);break;case g.failure:t.setAttribute("role","checkbox"),t.setAttribute("aria-checked","false"),t.setAttribute("aria-busy","false"),t.setAttribute("aria-label",v.ariaFailed)}const i=document.querySelector("#sr-status");if(i)switch(e){case g.loading:i.textContent=v.srLoading;break;case g.completed:i.textContent=v.srSuccess;break;case g.failure:i.textContent=v.srFailed;break;default:i.textContent=""}},L=e=>{var t,i,r,a,n;p=e;const o=document.querySelector("#status-default"),s=document.querySelector("#status-failure"),c=document.querySelector("#status-computing"),l={checkbox:document.querySelector("#checkbox"),failure:document.querySelector("#failure"),completed:document.querySelector("#completed"),loading:document.querySelector("#loading")};e!==g.checkbox?null===(t=l.checkbox)||void 0===t||t.classList.add("fade-out"):null===(i=l.checkbox)||void 0===i||i.classList.remove("fade-out"),null===(r=l.loading)||void 0===r||r.classList.remove("show"),null===(a=l.failure)||void 0===a||a.classList.remove("show"),null===(n=l.completed)||void 0===n||n.classList.remove("show"),null==o||o.classList.add("hidden"),null==s||s.classList.add("hidden"),null==c||c.classList.add("hidden"),"failure"===e?(null==s||s.classList.remove("hidden"),E(0)):"loading"===e?(null==c||c.classList.remove("hidden"),E(-1)):"completed"===e?(null==o||o.classList.remove("hidden"),E(100)):(null==o||o.classList.remove("hidden"),E(0)),e!==g.checkbox&&requestAnimationFrame(()=>{var t;null===(t=l[e])||void 0===t||t.classList.add("show")}),A(e)},x=()=>{setTimeout(()=>{S(w.TOKEN_EXPIRED),L(g.checkbox)},3e5)},V=async(e,t,i)=>{try{const r=await fetch(`${u}${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:e,nonce:t,solution:i,pid:window.__SWETRIX_PROJECT_ID})});if(!r.ok)throw new Error("Verification failed");const a=await r.json();if(!a.success)throw new Error("Verification failed");return a.token}catch(e){return o("Failed to verify solution:",e),S(w.FAILURE),L(g.failure),null}},z=(e,t)=>{const i=e/(Math.pow(16,t)/2)*100;return Math.min(95,10*Math.sqrt(i))},P=async e=>{const{challenge:t,difficulty:i}=e;let r=0;const a=Date.now(),n=async e=>{const t=(new TextEncoder).encode(e),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,"0")).join("")},s=(e,t)=>{for(let i=0;i<t;i++)if("0"!==e[i])return!1;return!0};for(;r<f;){if(Date.now()-a>=h)return o(`PoW main-thread timeout: 300000ms elapsed after ${r} attempts`),S(w.FAILURE),void L(g.failure);const e=`${t}:${r}`,c=await n(e);if(s(c,i)){E(100);const e=await V(t,r,c);return void(e&&(S(w.SUCCESS,{token:e}),x(),L(g.completed)))}if(r++,r%1e3==0){const e=z(r,i);E(e)}}o("PoW main-thread max iterations reached: 100000000 attempts"),S(w.FAILURE),L(g.failure)},C=async()=>{if(p===g.loading||p===g.completed)return;if(p===g.failure)return void L(g.checkbox);L(g.loading);const e=await(async()=>{try{const e=await fetch(`${u}${m}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pid:window.__SWETRIX_PROJECT_ID})});if(!e.ok)throw new Error("Failed to generate challenge");return await e.json()}catch(e){return o("Failed to generate challenge:",e),S(w.FAILURE),L(g.failure),null}})();e&&await(async e=>new Promise((t,i)=>{k&&k.terminate();try{k=new Worker(d)}catch(r){return s("Failed to create worker:",r),void P(e).then(t).catch(i)}k.onmessage=async i=>{const r=i.data;if("progress"===r.type){const t=z(r.attempts,e.difficulty);return void E(t)}if("timeout"===r.type)return o("PoW worker timeout:",r.reason),S(w.FAILURE),L(g.failure),null==k||k.terminate(),k=null,void t();if("result"===r.type){E(100);const i=await V(e.challenge,r.nonce,r.solution);return i&&(S(w.SUCCESS,{token:i}),x(),L(g.completed)),null==k||k.terminate(),k=null,void t()}if("error"===r.type)return o("PoW worker error message:",r.message||"Unknown error"),S(w.FAILURE),L(g.failure),null==k||k.terminate(),k=null,void t();s("PoW worker received unexpected message type:",r.type,"Raw data:",r),S(w.FAILURE),L(g.failure),null==k||k.terminate(),k=null,t()},k.onerror=r=>{o("PoW worker error:",r),null==k||k.terminate(),k=null,P(e).then(t).catch(i)},k.postMessage({challenge:e.challenge,difficulty:e.difficulty})}))(e)};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#swetrix-captcha"),t=document.querySelector("#branding");(()=>{const e=document.querySelector("#status-default"),t=document.querySelector("#status-failure"),i=document.querySelector("#status-computing span"),r=document.querySelector("#progress-bar-container");e&&(e.textContent=v.iAmHuman),t&&(t.textContent=v.verificationFailed),i&&(i.textContent=v.verifying),r&&r.setAttribute("aria-label",v.ariaProgress),document.documentElement.lang=b})(),null==t||t.addEventListener("click",e=>{e.stopPropagation()}),null==e||e.addEventListener("click",C),null==e||e.addEventListener("keydown",e=>{const t=e;"Enter"!==t.key&&" "!==t.key||(e.preventDefault(),C())}),null==e||e.addEventListener("keyup",e=>{" "===e.key&&e.preventDefault()}),A(g.checkbox)})});
//# sourceMappingURL=captcha.js.map
