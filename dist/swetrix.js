!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).swetrix={})}(this,(function(t){"use strict";const e=t=>{const e=location.search.match(t);return e&&e[2]||void 0},i=/[?&](ref|source|utm_source)=([^?&]+)/,o=/[?&](utm_campaign)=([^?&]+)/,a=/[?&](utm_medium)=([^?&]+)/,n=/[?&](utm_term)=([^?&]+)/,s=/[?&](utm_content)=([^?&]+)/,r=()=>void 0!==navigator.languages?navigator.languages[0]:navigator.language,c=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(t){return}},h=()=>document.referrer||void 0,l=()=>e(i),d=()=>e(a),u=()=>e(o),p=()=>e(n),v=()=>e(s),g=t=>{let e=location.pathname||"";if(t.hash){const t=location.hash.indexOf("?");e+=t>-1?location.hash.substring(0,t):location.hash}if(t.search){const t=location.hash.indexOf("?");e+=location.search||(t>-1?location.hash.substring(t):"")}return e},m={stop(){}};class f{constructor(t,e){this.projectID=t,this.options=e,this.pageData=null,this.pageViewsOptions=null,this.errorsOptions=null,this.perfStatsCollected=!1,this.activePage=null,this.errorListenerExists=!1,this.trackPathChange=this.trackPathChange.bind(this),this.heartbeat=this.heartbeat.bind(this),this.captureError=this.captureError.bind(this)}captureError(t){var e,i,o,a;"number"==typeof(null===(e=this.errorsOptions)||void 0===e?void 0:e.sampleRate)&&this.errorsOptions.sampleRate>=Math.random()||this.submitError({filename:t.filename,lineno:t.lineno,colno:t.colno,name:(null===(i=t.error)||void 0===i?void 0:i.name)||"Error",message:(null===(o=t.error)||void 0===o?void 0:o.message)||t.message,stackTrace:null===(a=t.error)||void 0===a?void 0:a.stack},!0)}trackErrors(t){return this.errorListenerExists||!this.canTrack()?m:(this.errorsOptions=t,window.addEventListener("error",this.captureError),this.errorListenerExists=!0,{stop:()=>{window.removeEventListener("error",this.captureError),this.errorListenerExists=!1}})}submitError(t,e){var i,o,a;const n={pid:this.projectID},s={pg:this.activePage||g({hash:null===(i=this.pageViewsOptions)||void 0===i?void 0:i.hash,search:null===(o=this.pageViewsOptions)||void 0===o?void 0:o.search}),lc:r(),tz:c(),...t};if(e&&(null===(a=this.errorsOptions)||void 0===a?void 0:a.callback)){const t=this.errorsOptions.callback(s);if(!1===t)return;t&&"object"==typeof t&&Object.assign(s,t)}Object.assign(s,n),this.sendRequest("error",s)}async track(t){var e,i;if(!this.canTrack())return;const o={...t,pid:this.projectID,pg:this.activePage||g({hash:null===(e=this.pageViewsOptions)||void 0===e?void 0:e.hash,search:null===(i=this.pageViewsOptions)||void 0===i?void 0:i.search}),lc:r(),tz:c(),ref:h(),so:l(),me:d(),ca:u(),te:p(),co:v()};await this.sendRequest("custom",o)}trackPageViews(t){if(!this.canTrack())return m;if(this.pageData)return this.pageData.actions;let e;this.pageViewsOptions=t,(null==t?void 0:t.unique)||(e=setInterval(this.trackPathChange,2e3)),setTimeout(this.heartbeat,3e3);const i=setInterval(this.heartbeat,28e3),o=g({hash:null==t?void 0:t.hash,search:null==t?void 0:t.search});return this.pageData={path:o,actions:{stop:()=>{clearInterval(e),clearInterval(i)}}},this.trackPage(o,null==t?void 0:t.unique),this.pageData.actions}getPerformanceStats(){var t;if(!this.canTrack()||this.perfStatsCollected||!(null===(t=window.performance)||void 0===t?void 0:t.getEntriesByType))return{};const e=window.performance.getEntriesByType("navigation")[0];return e?(this.perfStatsCollected=!0,{dns:e.domainLookupEnd-e.domainLookupStart,tls:e.secureConnectionStart?e.requestStart-e.secureConnectionStart:0,conn:e.secureConnectionStart?e.secureConnectionStart-e.connectStart:e.connectEnd-e.connectStart,response:e.responseEnd-e.responseStart,render:e.domComplete-e.domContentLoadedEventEnd,dom_load:e.domContentLoadedEventEnd-e.responseEnd,page_load:e.loadEventStart,ttfb:e.responseStart-e.requestStart}):{}}heartbeat(){var t;if(!(null===(t=this.pageViewsOptions)||void 0===t?void 0:t.heartbeatOnBackground)&&"hidden"===document.visibilityState)return;const e={pid:this.projectID};this.sendRequest("hb",e)}trackPathChange(){var t,e;if(!this.pageData)return;const i=g({hash:null===(t=this.pageViewsOptions)||void 0===t?void 0:t.hash,search:null===(e=this.pageViewsOptions)||void 0===e?void 0:e.search}),{path:o}=this.pageData;o!==i&&this.trackPage(i,!1)}trackPage(t,e=!1){if(!this.pageData)return;this.pageData.path=t;const i=this.getPerformanceStats();this.activePage=t,this.submitPageView({pg:t},e,i,!0)}submitPageView(t,e,i,o){var a;const n={pid:this.projectID,perf:i,unique:e},s={lc:r(),tz:c(),ref:h(),so:l(),me:d(),ca:u(),te:p(),co:v(),...t};if(o&&(null===(a=this.pageViewsOptions)||void 0===a?void 0:a.callback)){const t=this.pageViewsOptions.callback(s);if(!1===t)return;t&&"object"==typeof t&&Object.assign(s,t)}Object.assign(s,n),this.sendRequest("",s)}canTrack(){var t,e,i,o;return!((null===(t=this.options)||void 0===t?void 0:t.disabled)||"undefined"==typeof window||(null===(e=this.options)||void 0===e?void 0:e.respectDNT)&&"1"===(null===(i=window.navigator)||void 0===i?void 0:i.doNotTrack)||!(null===(o=this.options)||void 0===o?void 0:o.devMode)&&("localhost"===(null===location||void 0===location?void 0:location.hostname)||"127.0.0.1"===(null===location||void 0===location?void 0:location.hostname)||""===(null===location||void 0===location?void 0:location.hostname))||(null===navigator||void 0===navigator?void 0:navigator.webdriver))}async sendRequest(t,e){var i;const o=(null===(i=this.options)||void 0===i?void 0:i.apiURL)||"https://api.swetrix.com/log";await fetch(`${o}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}}t.LIB_INSTANCE=null,t.init=function(e,i){return t.LIB_INSTANCE||(t.LIB_INSTANCE=new f(e,i)),t.LIB_INSTANCE},t.pageview=function(e){t.LIB_INSTANCE&&t.LIB_INSTANCE.submitPageView(e.payload,Boolean(e.unique),{})},t.track=async function(e){t.LIB_INSTANCE&&await t.LIB_INSTANCE.track(e)},t.trackError=function(e){t.LIB_INSTANCE&&t.LIB_INSTANCE.submitError(e,!1)},t.trackErrors=function(e){return t.LIB_INSTANCE?t.LIB_INSTANCE.trackErrors(e):m},t.trackPageview=function(e,i,o){t.LIB_INSTANCE&&t.LIB_INSTANCE.submitPageView({pg:e},Boolean(o),{})},t.trackViews=function(e){return new Promise((i=>{t.LIB_INSTANCE?"undefined"==typeof document||"complete"===document.readyState?i(t.LIB_INSTANCE.trackPageViews(e)):window.addEventListener("load",(()=>{i(t.LIB_INSTANCE.trackPageViews(e))})):i(m)}))}}));
//# sourceMappingURL=swetrix.js.map
